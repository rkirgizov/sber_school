-- Бонусное задание 6. Оконные функции, знакомство с данными для дз

-- Финишируем задание про SCD1 инкременты с обработкой входных HTML блоков.
-- Сделано, отправлено в бонусном задании 5.

-- Знакомство с БД оператора:
-- Какая расценка действует на этот момент на исходящие звонки по разным тарифным планам? А на SMS?
----------------------------------------------------------------------------------------------------
select
    types.rate_type_desc || ' (' || rates.rate_name || ')' as tarif,
    max(items.cost) as current_cost
from
    baratin.rate_items items
inner join
    baratin.rates rates
    on items.rate = rates.rate_id
inner join
    baratin.rate_types types
    on items.type = types.rate_type_id
where 
    -- получаем часы и минуты дня
    extract (hour from systimestamp) * 3600 + extract (minute from systimestamp) * 60 
        between items.from_time and items.to_time 
    -- сравниваем день недели
    and (items.day_of_week = to_number (to_char (sysdate,'D')) or day_of_week is null)
    and items.type in (2,3,4)
group by 
    types.rate_type_desc || ' (' || rates.rate_name || ')'
order by 
    tarif
    
    
-- Создайте таблицу: колонки – дни недели, строки – часовой диапазон (0:00-1:00), поля – тариф на исходящий звонок в этот период.
----------------------------------------------------------------------------------------------------




-- Выведите дату и сумму последнего платежа по каждому номеру телефона.



-- Продолжение задания про таблицу DE3AT.XXXX_SALARY_HIST, где XXXX - ваш идентификатор.
-- В таблице должна быть SCD2 версия таблицы DE_COMMON.HISTGROUP (поля PERSON, CLASS, SALARY, EFFECTIVE_FROM, EFFECTIVE_TO).
-- Возьмите в работу таблицы DE3AT.XXXX_SALARY_HIST и DE.PAYMENTS.
-- Напишите SQL скрипт, выводящий таблицу платежей сотрудникам. В таблице должны быть поля PAYMENT_DT, PERSON, PAYMENT, MONTH_PAID, MONTH_REST.
-- MONTH_PAID - суммарно выплачено в месяце,
-- MONTH_REST - осталось выплатить за месяц.
-- Проверяется в первую очередь понимание как соединять фактовую таблицу с SCD2 таблицей.
